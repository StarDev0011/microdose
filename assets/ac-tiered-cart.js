ACDiscountApp.CartPage.Show_CalculateTier=function(){var e=function(e,a,l,r,t,o){if(t){var i=globalFields.ConvertToFixedDecimalNumber(e.original_price/100),n=globalFields.ConvertToFixedDecimalNumber(e.original_line_price/100),c=a==i;a=globalFields.ConvertToFixedDecimalString(a),l=globalFields.ConvertToFixedDecimalString(l),r||c?(jQuery(".cart__items .cart-items .cart-item .cart-item__details").eq(o).find(".product-option:first").html('<div><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+a+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(a,globalFields.amount)+"</span></div>"),jQuery("#CartDrawer-CartItems .cart-item__details").eq(o).find(".product-option:first").html('<div><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+a+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(a,globalFields.amount)+"</span></div>"),jQuery(".cart-item__totals.right.small-hide .cart-item__price-wrapper .price.price--end").eq(o).html('<div><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+l+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(l,globalFields.amount)+"</span></div>"),jQuery("#CartDrawer-CartItems .cart-item__price-wrapper .price.price--end").eq(o).html('<div><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+l+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(l,globalFields.amount)+"</span></div>")):(i=globalFields.ConvertToFixedDecimalString(i),n=globalFields.ConvertToFixedDecimalString(n),jQuery(".cart__items .cart-items .cart-item .cart-item__details").eq(o).find(".product-option:first").html('<div class="cart-item__original-price"><s><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+i+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(i,globalFields.amount)+'</span></s></div> <div><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+a+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(a,globalFields.amount)+"</span></div>"),jQuery("#CartDrawer-CartItems .cart-item__details").eq(o).find(".product-option:first").html('<div class="cart-item__original-price"><s><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+i+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(i,globalFields.amount)+'</span></s></div> <div><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+a+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(a,globalFields.amount)+"</span></div>"),jQuery(".cart-item__totals.right.small-hide .cart-item__price-wrapper .price.price--end").eq(o).html('<div class="cart-item__original-price"><s><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+n+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(n,globalFields.amount)+'</span></s></div> <div style="margin-left:5px"><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+l+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(l,globalFields.amount)+"</span></div>"),jQuery("#CartDrawer-CartItems .cart-item__price-wrapper .price.price--end").eq(o).html('<div class="cart-item__original-price"><s><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+n+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(n,globalFields.amount)+'</span></s></div> <div style="margin-left:5px"><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+l+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(l,globalFields.amount)+"</span></div>"))}},a=function(){jQuery('#CartDrawer .cart__ctas button[name="checkout"]').click((function(e){e.preventDefault(),l(!0)}))},l=function(e){o>0?jQuery.ajax({type:"POST",async:!1,url:"https://customerapp.anncode.com/tier/ACPGenerateDiscountCode",data:{priceDifference:o,subTotal:t,variantIds:r.toString()},success:function(a){var l=JSON.stringify(a),r=JSON.parse(l),t=r.PRID,o=r.DCID,i=r.DiscountCode;g("discountCodes",t+"-"+o+"-"+i,30),e?(u(i),window.location.href="/checkout?discount="+i):(u(i),jQuery('form[action="/cart"]').append('<input id="discount_input" type="hidden" name="discount" value="'+i+'">'),window.location.href="/checkout?discount="+i)},error:function(e){console.log(e.statusText),window.location.href="/checkout"}}):window.location.href="/checkout"},r=[],t=0,o=0,n=null,c=function(e,a){r=[],t=0,o=0;var l=0;for(k=0;k<e.items.length;k++){var i=e.items[k],c=!0;if(itemTiers=s(i.variant_id),null!=itemTiers&&itemTiers.status&&globalFields.StartEndDateValid(itemTiers.start_date,itemTiers.end_date)){var u=d(i,itemTiers,l,a,!0,k);l=u[0],c=u[1],u[1]&&(l+=globalFields.ConvertToFixedDecimalNumber(i.original_line_price/100))}else l+=globalFields.ConvertToFixedDecimalNumber(i.original_line_price/100);c||(t+=globalFields.ConvertToFixedDecimalNumber(i.original_line_price/100),r.push(i.variant_id))}!function(e,a,l){e&&(a=globalFields.ConvertToFixedDecimalString(a),(l=globalFields.ConvertToFixedDecimalString(l))!=a?(jQuery(".cart__footer .totals .totals__subtotal-value").html('<s><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+l+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(l,globalFields.amount)+'</span></s> <span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+a+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(a,globalFields.amount)+"</span>"),jQuery(".cart-drawer__footer .totals .totals__subtotal-value").html('<s><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+l+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(l,globalFields.amount)+'</span></s> <span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+a+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(a,globalFields.amount)+"</span>")):(jQuery(".cart__footer .totals .totals__subtotal-value").html('<span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+a+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(a,globalFields.amount)+"</span>"),jQuery(".cart-drawer__footer .totals .totals__subtotal-value").html('<span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+a+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(a,globalFields.amount)+"</span>")))}(a,globalFields.ConvertToFixedDecimalNumber(l),globalFields.ConvertToFixedDecimalNumber(e.original_total_price/100)),o=globalFields.ConvertToFixedDecimalNumber(globalFields.ConvertToFixedDecimalNumber(e.original_total_price/100)-globalFields.ConvertToFixedDecimalNumber(l)),function(e){if(o>0&&e&&globalFields.isCartPage){var a='<span id="saved-banner">'+globalFields.settings.cart_saving_message.replace("{{discount_amount}}",'<span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+o.toFixed(2)+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(o.toFixed(2),globalFields.amount)+"</span>")+"</span>";jQuery(window).width()<700?0==jQuery("#saved-banner-div").length?jQuery(".cart__footer .totals").after('<div id="saved-banner-div" style="text-align: center;" class="col-md-14">'+a+"</div>"):jQuery("#saved-banner-div").html(a):0==jQuery("#saved-banner-div").length?jQuery(".cart__footer .totals").after('<div id="saved-banner-div" style="text-align: end;" class="col-md-14">'+a+"</div>"):jQuery("#saved-banner-div").html(a)}else globalFields.isCartPage&&jQuery("#saved-banner-div").remove()}(a),o&&(n=setInterval((function(){console.log("buttons and tiered"),jQuery(".additional_checkout_buttons, .dynamic-checkout__content").length>0&&(jQuery(".additional_checkout_buttons, .dynamic-checkout__content").hide(),clearInterval(n))}),500)),setTimeout((function(){clearInterval(n)}),5e3)};setTimeout((function(){clearInterval(n)}),1e4);var s=function(e){var a=jQuery.grep(globalFieldsCartPage_AC.cartTiersArray,(function(a){return a.variant_id===e}));return"[]"==a[0].tiers?void 0:globalFields.GetTierObject(a[0].tiers[0],e)},d=function(a,l,r,t,o,n){for(i=0;i<l.tier_min.length;i++){var c=0,s=parseFloat(l.tier_values[i]),d=parseInt(l.tier_min[i]),u="max"!=l.tier_max[i]?parseInt(l.tier_max[i]):l.tier_max[i],y=0,b=0,g=!1,m=!1;if("products"===l.entity_type||"collections"===l.entity_type){var F=[];if("collections"===l.entity_type)for(var p=jQuery.grep(globalFieldsCartPage_AC.cartTiersArray,(function(e){return"[]"!=e.tiers&&"collections"==e.tiers[0].entity_type&&e.tiers[0].entity_id==l.entity_id})),_=0;_<p.length;_++){var v=jQuery.grep(globalFieldsCartPage_AC.cartObj.items,(function(e){return e.variant_id==p[_].variant_id}));0!=v.length&&F.push(v[0])}else F=jQuery.grep(globalFieldsCartPage_AC.cartObj.items,(function(e){return e.product_id==a.product_id}));for(j=0;j<F.length;j++)c+=F[j].quantity;g=c>=d,m="max"==u||c<=u}else g=a.quantity>=d,m="max"==u||a.quantity<=u;if(g&&m){if(o=!1,"percentage"==l.discount_type){var f=parseFloat(globalFields.ConvertToFixedDecimalNumber(parseFloat(s)/100*globalFields.ConvertToFixedDecimalNumber(a.original_price/100)));y=globalFields.ConvertToFixedDecimalNumber(globalFields.ConvertToFixedDecimalNumber(a.original_price/100)-f)}else"fixed"==l.discount_type?y=globalFields.ConvertToFixedDecimalNumber(globalFields.ConvertToFixedDecimalNumber(a.original_price/100)-parseFloat(s)):"fixed_price"==l.discount_type&&(y=globalFields.ConvertToFixedDecimalNumber(parseFloat(s)));y<0&&(y=0),b=globalFields.ConvertToFixedDecimalNumber(y*a.quantity),r+=globalFields.ConvertToFixedDecimalNumber(b),e(a,y,b,o,t,n)}}return o&&e(a,globalFields.ConvertToFixedDecimalNumber(a.original_price/100),globalFields.ConvertToFixedDecimalNumber(a.original_line_price/100),o,t,n),[r,o]},u=function(e){jQuery.ajax({type:"HEAD",url:"/discount/"+e,success:function(e){},error:function(e){console.log(e.statusText)}})};jQuery(document).ajaxComplete((function(e,a,l){y(l.url,a.responseText)}));var y=function(e,l){"undefined"!=e&&""!=e&&null!=e&&("/cart.js"!=(e=e.split("?"))[0]&&"/cart/change.js"!=e[0]||(globalFieldsCartPage_AC.cartObj=JSON.parse(l),setTimeout((function(){jQuery.ajax({async:!1,url:"/cart/?view=ac_cart_tiers",success:function(e){globalFieldsCartPage_AC.cartTiersArray=JSON.parse(e),c(globalFieldsCartPage_AC.cartObj,!0),a()},error:function(e){console.log(e.statusText)}})}),800)))};try{var b=window.fetch;window.fetch=function(...e){return(e[0].includes("/cart/change")||e[0].includes("/cart/add"))&&setTimeout((function(){fetch("/cart.js").then((e=>e.json().then((a=>({status:e.status,body:a}))))).then((e=>y("/cart.js",JSON.stringify(e.body))))}),500),b.apply(window,e)}}catch(e){}var g=function(e,a,l){var r=new Date;r.setTime(r.getTime()+24*l*60*60*1e3);var t="expires="+r.toUTCString();document.cookie=e+"="+a+";"+t+";path=/"};c(globalFieldsCartPage_AC.cartObj,!0),jQuery('.cart__blocks .cart__ctas button[name="checkout"]').click((function(){c(globalFieldsCartPage_AC.cartObj,!1),l(!1)})),a()};var globalFieldsCartPage_AC=new ACDiscountApp.CartPage.Global,cartObject=new ACDiscountApp.CartPage.Show_CalculateTier;